<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <style>
    body {
      font-family: Arial, sans-serif;
      font-size: 12px;
      padding: 20px;
      color: #000;
    }
    .center { text-align: center; }
    .header, .footer { margin-bottom: 10px; }
    .logo { width: 100px; margin-bottom: 10px; }
    .bold { font-weight: bold; }
    .details, .totals, .gst-summary {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    .details th, .details td,
    .totals th, .totals td,
    .gst-summary th, .gst-summary td {
      border: 1px solid #000;
      padding: 4px 6px;
      text-align: center;
    }
    .no-border { border: none; }
    .right { text-align: right; }
    .left { text-align: left; }
  </style>
</head>
<body>
  <div class="center header">
    <img src="<%= logoPath %>" class="logo" />
    <h2>Bhavya Enterprises</h2>
    <p>Regd Office: SCO 393 2nd Floor, Sector 37-D, Chandigarh 160036</p>
    <p>B.O.: Plot No. 1025, Rani Sati Nagar, Nirman Nagar, Jaipur-302019</p>
    <p>Helpdesk No: +91 9988818489, +91 9815922428</p>
    <p>GST NO: 04AXJPV5221C1ZP</p>
    <h3>QUOTATION PROFORMA <span style="float:right;">Original Copy</span></h3>
  </div>

  <p><strong>Quotation To Party</strong></p>
  <p>
    <strong>CODE Serial No -</strong> <%= quotationId %><br/>
    <strong>Date:</strong> <%= date %><br/>
    <strong>Quote No:</strong> BE/<%= date.split("/")[1] %>/<%= quotationId %><br/>
    <strong>Quotation valid until:</strong> <%= validUntil %><br/>
    <strong>GST Sales Type:</strong> Interstate
  </p>

  <table class="details">
    <thead>
      <tr>
        <th>S.No</th>
        <th>Goods Description</th>
        <th>RC-SNo</th>
        <th>Make</th>
        <th>Where in Use</th>
        <th>Unit</th>
        <th>QTY.</th>
        <th>Unit Price</th>
        <th>Total Value</th>
      </tr>
    </thead>
    <tbody>
      <% rateCards.forEach((card, index) => {
        const detail = rateCardDetails.find(d => d.rateCardId === card.id);
        if (!detail) return;
      %>
        <tr>
          <td><%= index + 1 %></td>
          <td><%= card.description %></td>
          <td><%= card.bankRcNo %></td>
          <td><%= card.bankName %></td>
          <td>--</td>
          <td><%= card.unit %></td>
          <td><%= detail.quantity %></td>
          <td><%= card.rate.toFixed(2) %></td>
          <td><%= (card.rate * detail.quantity).toFixed(2) %></td>
        </tr>
      <% }) %>
    </tbody>
  </table>

  <p class="right"><strong>Total:</strong> ₹ <%= grandTotal.toFixed(2) %></p>

  <table class="totals">
    <tr>
      <td class="left" colspan="6"><strong>Total Value (In Figures)</strong></td>
      <td colspan="3" class="right">INR ₹ <%= grandTotal.toFixed(2) %></td>
    </tr>
    <tr>
      <td class="left" colspan="9">
        <strong>Total Value (In Words):</strong> Rupees <%= grandTotal.toFixed(2) %> Only
      </td>
    </tr>
  </table>

  <table class="gst-summary">
    <thead>
      <tr>
        <th>TAX (%)</th>
        <th>Taxable Value</th>
      </tr>
    </thead>
    <tbody>
      <% const gstGroups = rateCardDetails.reduce((acc, d) => {
        const card = rateCards.find(c => c.id === d.rateCardId);
        if (!card) return acc;
        acc[d.gstType] = (acc[d.gstType] || 0) + (card.rate * d.quantity);
        return acc;
      }, {}); %>
      <% Object.entries(gstGroups).forEach(([rate, value]) => { %>
        <tr>
          <td>IGST <%= rate %>%</td>
          <td><%= value.toFixed(2) %></td>
        </tr>
      <% }) %>
    </tbody>
  </table>

  <p class="right"><strong>Total Taxable Value:</strong> ₹ <%= subtotal.toFixed(2) %></p>
  <p class="right"><strong>Discount:</strong> ₹ 0.00</p>
  <p class="right"><strong>Net Gross (Amount):</strong> ₹ <%= grandTotal.toFixed(2) %></p>

  <div class="center footer">
    <p><%= date %></p>
    <p><strong>Quote by:</strong> Bhavya Enterprises</p>
  </div>
</body>
</html>
