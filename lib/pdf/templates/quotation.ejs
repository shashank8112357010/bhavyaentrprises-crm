<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <style>
    body {
      font-family: Arial, sans-serif;
      font-size: 12px;
      padding: 20px;
      color: #000;
    }
    .center { text-align: center; }
    .header, .footer { margin-bottom: 10px; }
    .logo { width: 100px; margin-bottom: 10px; }
    .bold { font-weight: bold; }
    .details, .totals, .gst-summary {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    .details th, .details td,
    .totals th, .totals td,
    .gst-summary th, .gst-summary td {
      border: 1px solid #000;
      padding: 4px 6px;
      text-align: center;
    }
    .no-border { border: none; }
    .right { text-align: right; }
    .left { text-align: left; }
  </style>
</head>
<body>
  <div class="center header">
    <img src="<%= logoPath %>" class="logo" />
    <h2>Bhavya Enterprises</h2>
    <p>Regd Office: SCO 393 2nd Floor, Sector 37-D, Chandigarh 160036</p>
    <p>B.O.: Plot No. 1025, Rani Sati Nagar, Nirman Nagar, Jaipur-302019</p>
    <p>Helpdesk No: +91 9988818489, +91 9815922428</p>
    <p>GST NO: 04AXJPV5221C1ZP</p>
    <h3>QUOTATION PROFORMA <span style="float:right;">Original Copy</span></h3>
    <% if (quotationName && quotationName.trim() !== "") { %>
      <h4><%= quotationName %></h4>
    <% } %>
  </div>

  <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
    <div style="width: 60%;">
      <p><strong>Quotation To Party:</strong></p>
      <p class="bold"><%= client.name %></p>
      <% if (client.address) { %><p><%= client.address %></p><% } %>
      <% if (client.gstin) { %><p><strong>GSTIN:</strong> <%= client.gstin %></p><% } %>
    </div>
    <div style="width: 38%; text-align: right;">
      <p><strong>Quotation ID:</strong> <%= quotationId %></p>
      <p><strong>Date:</strong> <%= quotationDate %></p>
      <% if (expiryDate) { %>
        <p><strong>Valid Until:</strong> <%= expiryDate %></p>
      <% } %>
      <p><strong>GST Sales Type:</strong> Interstate</p> {/* Assuming this is static or passed if dynamic */}
    </div>
  </div>

  <table class="details">
    <thead>
      <tr>
        <th>S.No</th>
        <th>Goods Description</th>
        <th>Unit</th>
        <th>QTY.</th>
        <th>Rate (<%= currency %>)</th>
        <th>Amount (<%= currency %>)</th>
        <th>GST @ (%)</th>
        <th>GST Amt (<%= currency %>)</th>
        <th>Total (<%= currency %>)</th>
      </tr>
    </thead>
    <tbody>
      <% items.forEach(item => { %>
        <tr>
          <td><%= item.srNo %></td>
          <td><%= item.description %></td>
          <td><%= item.unit %></td>
          <td><%= item.quantity %></td>
          <td><%= item.rate.toFixed(2) %></td>
          <td><%= item.itemSubtotal.toFixed(2) %></td>
          <td><%= item.gstRate %>%</td>
          <td><%= item.itemGstAmount.toFixed(2) %></td>
          <td><%= item.itemGrandTotal.toFixed(2) %></td>
        </tr>
      <% }) %>
    </tbody>
  </table>
  
  <table class="totals" style="margin-top: 5px;">
    <tr>
      <td class="left bold" colspan="5">Sub Total</td>
      <td class="right bold" colspan="4"><%= currency %> <%= subTotal.toFixed(2) %></td>
    </tr>
    <tr>
      <td class="left bold" colspan="5">Total GST</td>
      <td class="right bold" colspan="4"><%= currency %> <%= gst.toFixed(2) %></td>
    </tr>
    <tr>
      <td class="left bold" colspan="5">Grand Total</td>
      <td class="right bold" colspan="4"><%= currency %> <%= grandTotal.toFixed(2) %></td>
    </tr>
     <tr>
      <td class="left" colspan="9">
        <strong>Total Value (In Words):</strong> <%= currency %> <%= grandTotal.toFixed(2) %> Only {/* TODO: Convert number to words */}
      </td>
    </tr>
  </table>

  <table class="gst-summary">
    <thead>
      <tr>
        <th>GST Rate</th>
        <th>Taxable Value (<%= currency %>)</th>
        <th>GST Amount (<%= currency %>)</th>
      </tr>
    </thead>
    <tbody>
      <% const gstSummary = items.reduce((acc, item) => {
          const rateKey = `${item.gstRate}%`;
          if (!acc[rateKey]) {
            acc[rateKey] = { taxableValue: 0, gstAmount: 0 };
          }
          acc[rateKey].taxableValue += item.itemSubtotal;
          acc[rateKey].gstAmount += item.itemGstAmount;
          return acc;
        }, {}); 
      %>
      <% Object.entries(gstSummary).forEach(([rate, values]) => { %>
        <tr>
          <td>IGST <%= rate %></td>
          <td><%= values.taxableValue.toFixed(2) %></td>
          <td><%= values.gstAmount.toFixed(2) %></td>
        </tr>
      <% }) %>
       <tr>
          <td class="bold">Total</td>
          <td class="bold"><%= subTotal.toFixed(2) %></td>
          <td class="bold"><%= gst.toFixed(2) %></td>
        </tr>
    </tbody>
  </table>
  
  <% if (notes && notes.trim() !== "") { %>
  <div class="notes-section" style="margin-top: 15px; border: 1px solid #000; padding: 8px;">
    <h4>Notes:</h4>
    <p style="white-space: pre-wrap;"><%= notes %></p>
  </div>
  <% } %>

  <div class="center footer" style="margin-top: 30px;">
    <p>Quotation Date: <%= quotationDate %></p>
    <p><strong>Quote by:</strong> Bhavya Enterprises</p>
  </div>
</body>
</html>
