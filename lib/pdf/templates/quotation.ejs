<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quotation - <%= quotationNumber %></title>
    <style>
        body { font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 10px; color: #333; line-height: 1.4; margin: 0; padding: 0; }
        .container { width: 100%; max-width: 800px; margin: 20px auto; padding: 20px; border: 1px solid #eee; box-shadow: 0 0 10px rgba(0,0,0,0.05); }

        .header, .footer { text-align: center; margin-bottom: 20px; }
        .header img.logo { max-width: 150px; margin-bottom: 10px; }
        .header h1 { margin: 0; font-size: 1.8em; color: #2c3e50; }
        .header p { margin: 2px 0; font-size: 0.9em; }

        .section { margin-bottom: 20px; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        .section-title { font-size: 1.2em; font-weight: bold; margin-bottom: 10px; padding-bottom: 5px; border-bottom: 1px solid #eee; color: #2980b9; }

        .grid-container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .grid-item table { width: 100%; }
        .grid-item table td { padding: 4px 0; }
        .grid-item table td:first-child { font-weight: bold; width: 40%; color: #555; }

        .items-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .items-table th, .items-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        .items-table th { background-color: #f0f4f7; font-weight: bold; color: #34495e; }
        .items-table td.text-right, .items-table th.text-right { text-align: right; }
        .items-table td.text-center, .items-table th.text-center { text-align: center; }
        .items-table tr:nth-child(even) { background-color: #f9f9f9; }

        .summary-table { width: 100%; max-width: 350px; margin-left: auto; margin-top: 15px; }
        .summary-table td { padding: 5px 8px; }
        .summary-table td:first-child { font-weight: normal; text-align: right; width: 60%; }
        .summary-table td:last-child { font-weight: bold; text-align: right; }
        .summary-table tr.grand-total td { font-size: 1.1em; color: #c0392b; border-top: 2px solid #333; padding-top: 8px; }

        .amount-in-words { margin-top: 10px; font-style: italic; color: #555; }
        .terms-section, .bank-details-section { margin-top: 20px; padding-top: 10px; border-top: 1px dashed #ccc; }
        .terms-section ul { padding-left: 20px; margin: 5px 0; }
        .terms-section li { margin-bottom: 3px; }

        .footer p { font-size: 0.8em; color: #777; }
        .signature-area { margin-top: 40px; text-align: right; }
        .signature-line { width: 200px; border-top: 1px solid #333; margin: 0 0 5px auto; }

        /* Utility classes */
        .text-bold { font-weight: bold; }
        .mt-1 { margin-top: 5px; }
        .mt-2 { margin-top: 10px; }
        .mb-1 { margin-bottom: 5px; }
        .mb-2 { margin-bottom: 10px; }
        .text-muted { color: #6c757d; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <% if (locals.logoPath && typeof logoPath !== 'undefined' && logoPath) { %>
                <img src="<%= logoPath %>" alt="Company Logo" class="logo">
            <% } %>
            <h1><%= companyName %></h1>
            <p><%= companyAddressLine1 %>, <%= companyCityStateZip %></p>
            <p><%= companyPhone %> | <%= companyEmail %></p>
            <p>GSTIN: <%= companyGstin %></p>
        </div>

        <div class="section">
            <div class="section-title">Quotation</div>
            <div class="grid-container">
                <div class="grid-item">
                    <table>
                        <tr><td>Quotation No:</td><td><%= quotationNumber %></td></tr>
                        <tr><td>Date:</td><td><%= date %></td></tr>
                        <tr><td>Valid Until:</td><td><%= validUntil || 'N/A' %></td></tr>
                    </table>
                </div>
                <div class="grid-item">
                    <table>
                        <tr><td>Sales Type:</td><td><%= salesType %></td></tr>
                        <% if (locals.ticket && ticket && (ticket.id || ticket.title)) { %>
                            <tr><td>Ticket ID:</td><td><%= ticket.ticketId || ticket.id || 'N/A' %></td></tr>
                            <tr><td>Ticket Title:</td><td><%= ticket.title || 'N/A' %></td></tr>
                        <% } %>
                        <% if (locals.admin && admin) { %>
                            <tr><td>Prepared By:</td><td><%= admin %></td></tr>
                        <% } %>
                        <% if (locals.quoteBy && quoteBy) { %>
                            <tr><td>Account Manager:</td><td><%= quoteBy %></td></tr>
                        <% } %>
                    </table>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-title">Client Details</div>
            <p><span class="text-bold">To: <%= client.name %></span></p>
            <% if (client.address) { %><p><%= client.address %></p><% } %>
            <% if (client.contactPerson) { %><p>Kind Attn: <%= client.contactPerson %></p><% } %>
            <% if (client.contactPhone) { %><p>Phone: <%= client.contactPhone %></p><% } %>
            <% if (client.contactEmail) { %><p>Email: <%= client.contactEmail %></p><% } %>
            <% if (client.gstin) { %><p>Client GSTIN: <%= client.gstin %></p><% } %>
        </div>

        <div class="section">
            <div class="section-title">Items & Services</div>
            <table class="items-table">
                <thead>
                    <tr>
                        <th class="text-center">S.No</th>
                        <th>Description</th>
                        <% if (items.some(item => item.rcSno)) { %><th>RC-SNo</th><% } %>
                        <th class="text-center">Unit</th>
                        <th class="text-center">Qty</th>
                        <th class="text-right">Unit Price</th>
                        <th class="text-right">Total Value</th>
                    </tr>
                </thead>
                <tbody>
                    <% items.forEach(function(item) { %>
                        <tr>
                            <td class="text-center"><%= item.sno %></td>
                            <td><%= item.description %></td>
                            <% if (items.some(it => it.rcSno)) { %><td><%= item.rcSno || 'N/A' %></td><% } %>
                            <td class="text-center"><%= item.unit %></td>
                            <td class="text-center"><%= item.quantity %></td>
                            <td class="text-right"><%= item.unitPrice.toFixed(2) %></td>
                            <td class="text-right"><%= item.totalValue.toFixed(2) %></td>
                        </tr>
                    <% }); %>
                </tbody>
            </table>
        </div>

        <div class="section">
            <div class="section-title">Summary</div>
            <table class="summary-table">
                <tr><td>Subtotal:</td><td><%= subtotal.toFixed(2) %></td></tr>
                <% if (typeof discountAmount !== 'undefined' && discountAmount > 0) { %>
                    <tr>
                        <td>Discount <% if (typeof discountPercentage !== 'undefined' && discountPercentage > 0) { %>(<%= discountPercentage.toFixed(2) %>%)<% } %>:</td>
                        <td>- <%= discountAmount.toFixed(2) %></td>
                    </tr>
                    <tr><td>Taxable Value:</td><td><%= taxableValue.toFixed(2) %></td></tr>
                <% } else { %>
                    <tr><td>Taxable Value:</td><td><%= subtotal.toFixed(2) %></td></tr> <%# If no discount, taxable is same as subtotal %>
                <% } %>
                <tr>
                    <td>IGST <% if (typeof igstRate !== 'undefined' && igstRate > 0) { %>(<%= igstRate %>%)<% } %>:</td>
                    <td><%= igstAmount.toFixed(2) %></td>
                </tr>
                <tr class="grand-total">
                    <td>Net Amount:</td>
                    <td><%= netGrossAmount.toFixed(2) %></td>
                </tr>
            </table>
            <div class="amount-in-words mt-1">
                Amount in Words: <%= netGrossAmountInWords %>
            </div>
        </div>

        <% if (locals.termsAndConditions && termsAndConditions && termsAndConditions.length > 0) { %>
        <div class="section terms-section">
            <div class="section-title">Terms & Conditions</div>
            <ul>
                <% termsAndConditions.forEach(function(term) { %>
                    <li><%= term %></li>
                <% }); %>
            </ul>
        </div>
        <% } %>

        <% if (locals.companyBankName) { %>
        <div class="section bank-details-section">
            <div class="section-title">Bank Details</div>
            <p><span class="text-bold">Bank:</span> <%= companyBankName %></p>
            <p><span class="text-bold">Account No:</span> <%= companyBankAccount %></p>
            <p><span class="text-bold">IFSC Code:</span> <%= companyBankIfsc %></p>
            <p><span class="text-bold">Branch:</span> <%= companyBankBranch %></p>
            <% if (locals.upiQrPath && typeof upiQrPath !== 'undefined' && upiQrPath) { %>
                <div class="mt-2">
                    <p class="text-bold">Scan UPI QR Code for Payment:</p>
                    <img src="<%= upiQrPath %>" alt="UPI QR Code" style="max-width: 120px; margin-top: 5px;">
                </div>
            <% } %>
        </div>
        <% } %>

        <div class="footer">
            <div class="signature-area">
                <div class="signature-line"></div>
                <p>For <%= companyName %></p>
                <p>(Authorized Signatory)</p>
            </div>
            <p class="mt-2">This is a computer-generated document and does not require a physical signature.</p>
            <p>Thank you for your business!</p>
        </div>
    </div>
</body>
</html>
